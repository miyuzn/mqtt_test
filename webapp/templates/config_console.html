<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP32 配置调试台</title>
    <link rel="stylesheet" href="/static/css/config_console.css" />
  </head>
  <body>
    <header class="app-header">
      <div>
        <h1>ESP32 配置调试台</h1>
        <p>通过 MQTT 下发 analog/select，支持发送端自动匹配 DN→IP。</p>
      </div>
      <div class="header-actions">
        <button id="refresh-devices" class="ghost-btn" type="button">刷新设备</button>
        <button id="refresh-results" class="ghost-btn" type="button">刷新结果</button>
      </div>
    </header>

    <main class="app-main">
      <section class="panel image-panel">
        <img src="/static/images/pcb-layout-placeholder.png" alt="PCB IO 示意图" />
        <p class="image-hint">可将真实 PCB 图替换为 <code>static/images/pcb-layout.png</code>。</p>
        <div class="metric-line">
          <span id="device-count">设备：--</span>
          <span id="agent-count">发送端：--</span>
        </div>
      </section>

      <section class="panel form-panel">
        <form id="config-form">
          <div class="field">
            <label for="device-select">选择在线设备</label>
            <div class="device-picker">
              <select id="device-select"></select>
              <span class="device-meta" id="device-meta">未选择设备</span>
            </div>
          </div>

          <div class="field-group">
            <div class="field">
              <label for="dn-input">目标 DN</label>
              <input id="dn-input" placeholder="例如 3030F9268608" />
            </div>
            <div class="field">
              <label for="ip-input">指定 IP（可选）</label>
              <input id="ip-input" placeholder="通常无需填写" />
            </div>
          </div>

          <div class="field">
            <label for="operator-input">操作人 / 备注（可选）</label>
            <input id="operator-input" placeholder="your name" />
          </div>

          <div class="field">
            <label>analog（最多 11 个）</label>
            <div class="pin-selector">
              <div class="pin-grid" id="analog-grid"></div>
              <input id="analog-input" placeholder="使用逗号分隔，例如 7,6,5" />
            </div>
          </div>

          <div class="field">
            <label>select（最多 13 个）</label>
            <div class="pin-selector">
              <div class="pin-grid" id="select-grid"></div>
              <input id="select-input" placeholder="例如 42,41,40" />
            </div>
          </div>

          <footer class="form-actions">
            <button type="button" id="clear-form" class="ghost-btn">清空</button>
            <button type="submit" class="primary-btn">下发配置</button>
          </footer>
        </form>

        <section class="panel result-panel">
          <h2>最近一次结果</h2>
          <pre id="result-output">尚未下发</pre>
        </section>
      </section>
    </main>

    <section class="panel data-panel">
      <div class="panel-block">
        <header class="panel-block-header">
          <div>
            <h3>在线设备列表</h3>
            <p>数据来自各发送端的 DN→IP 映射广播。</p>
          </div>
        </header>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>DN</th>
                <th>IP</th>
                <th>发送端</th>
                <th>最近心跳</th>
              </tr>
            </thead>
            <tbody id="devices-table-body">
              <tr><td colspan="4" class="table-empty">暂无数据</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel-block">
        <header class="panel-block-header">
          <div>
            <h3>下发历史</h3>
            <p>展示最近的执行结果（最多 50 条）。</p>
          </div>
        </header>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>时间</th>
                <th>DN</th>
                <th>状态</th>
                <th>发送端</th>
                <th>详情</th>
              </tr>
            </thead>
            <tbody id="history-table-body">
              <tr><td colspan="5" class="table-empty">暂无数据</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <script src="/static/js/config_console.js" type="module"></script>
  </body>
</html>
