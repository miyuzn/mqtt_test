services:
  sink:
    build: ./app
    container_name: mqtt-sink
    environment:
      BROKER_HOST: ${TRANSFER_MQTT_HOST:-163.143.136.103}
      BROKER_PORT: ${TRANSFER_MQTT_PORT:-1883}
      MQTT_BROKER_HOST: ${TRANSFER_MQTT_HOST:-163.143.136.103}
      MQTT_BROKER_PORT: ${TRANSFER_MQTT_PORT:-1883}
      SUB_TOPICS: ${SUB_TOPICS:-demo/#,secure/#}
      PUB_TOPIC: ${PUB_TOPIC:-demo/hello}
      USERNAME: ${BROKER_USERNAME:-}
      PASSWORD: ${BROKER_PASSWORD:-}
    volumes:
      - ./app:/app
    command: ["python", "sink.py"]
    restart: unless-stopped

  web:
    build: ./webapp
    container_name: mqtt-web
    environment:
      BRIDGE_API_BASE_URL: ${BRIDGE_API_BASE_URL:-http://163.143.136.103:5001}
      BRIDGE_CONNECT_TIMEOUT: ${BRIDGE_CONNECT_TIMEOUT:-5}
      BRIDGE_READ_TIMEOUT: ${BRIDGE_READ_TIMEOUT:-30}
      CONFIG_CONSOLE_ENABLED: ${CONFIG_CONSOLE_ENABLED:-1}
      CONFIG_CONSOLE_PORT: ${CONFIG_CONSOLE_PORT:-5002}
      CONFIG_BROKER_HOST: ${CONFIG_BROKER_HOST:-163.143.136.103}
      CONFIG_BROKER_PORT: ${CONFIG_BROKER_PORT:-1883}
      CONFIG_BROKER_USERNAME: ${CONFIG_BROKER_USERNAME:-}
      CONFIG_BROKER_PASSWORD: ${CONFIG_BROKER_PASSWORD:-}
      LICENSE_ENABLED: ${LICENSE_ENABLED:-1}
      LICENSE_KEY_PATH: ${LICENSE_KEY_PATH:-/license/priv.pem}
      LICENSE_HISTORY_PATH: ${LICENSE_HISTORY_PATH:-/license/licenses_history.json}
      LICENSE_TCP_PORT: ${LICENSE_TCP_PORT:-22345}
      LICENSE_TCP_TIMEOUT: ${LICENSE_TCP_TIMEOUT:-5}
      LICENSE_DEFAULT_DAYS: ${LICENSE_DEFAULT_DAYS:-365}
      LICENSE_DEFAULT_TIER: ${LICENSE_DEFAULT_TIER:-basic}
      LICENSE_MODULE_DIR: ${LICENSE_MODULE_DIR:-/license}
    volumes:
      - ./webapp:/app
      - ./license:/license
    ports:
      - "5000:5000"
      - "5002:5002"
    restart: unless-stopped
